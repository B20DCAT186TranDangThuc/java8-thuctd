<html>
<head th:replace="admin/layout/head :: head"></head>
<body>

<nav th:replace="admin/layout/header :: header"></nav>

<nav th:replace="admin/layout/sidebar :: sidebar"></nav>

<!--Content-->
<div class="be-content" style="margin-top: 60px;">
    <div class="main-content container-fluid">
        <div class="page-head">
            <h2 class="page-head-title">User Management</h2>
            <nav aria-label="breadcrumb" role="navigation">
                <ol class="breadcrumb page-head-nav">
                    <li class="breadcrumb-item active">User List</li>
                </ol>
            </nav>
        </div>

        <div class="form-group row p-4">
            <div class="col-12 col-sm-5 col-lg-4">
                <form action="/user" method="get" class="input-group input-search">
                    <input class="form-control" type="text" name="keyword" placeholder="Search"
                    >
                    <span class="input-group-btn">
                                            <button class="btn btn-secondary" type="submit"><i
                                                    class="icon mdi mdi-search"></i></button>
                                        </span>
                </form>
            </div>
            <div class="col-12 col-sm-5 col-lg-3 mb-2 mb-sm-0">
                <form action="/user" method="get" style="height: 100%;">
                    <input type="hidden" name="keyword" value="${keyword}">
                    <select name="roleId" class="select2 select2-hidden-accessible"
                            id="icon-category" tabindex="-1" aria-hidden="true"
                            style="width: 100%; height: 80%; padding-left: 12px;"
                            onchange="this.form.submit()">
                        <option value="">All roles</option>
                        <option th:each="role : ${roles}"
                                th:text="${role}"></option>
                    </select>
                </form>
            </div>
            <div class="col-12 col-sm-2 col-lg-5 d-flex justify-content-end">
                <a th:href="@{/admin/accounts/add}" class="btn d-flex justify-content-center align-items-center"
                   style="border-radius: 50%;width: 40px; height: 40px">
                    <img th:src="@{/assets/img/add.png}" style="width: 50px; height: 50px";/>
                </a>
            </div>
        </div>

        <div class="col-sm-12">
            <div class="card card-table">
                <div class="card-body">
                    <div id="table2_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">
                        <div class="row be-datatable-body">
                            <div class="col-sm-12">
                                <table
                                        class="table table-striped table-hover table-fw-widget dataTable no-footer"
                                        id="table2" role="grid" aria-describedby="table2_info">
                                    <thead>
                                    <tr role="row">
                                        <th class="text-center" tabindex="0"
                                            aria-controls="table2" rowspan="1" colspan="1"
                                            aria-sort="ascending"
                                            aria-label="Rendering engine: activate to sort column descending"
                                            style="width: 100px;">Username</th>
                                        <th class="text-center" tabindex="0"
                                            aria-controls="table2" rowspan="1" colspan="1"
                                            aria-label="Browser: activate to sort column ascending"
                                            style="width: 220px;">Role</th>
                                        <th class="text-center" tabindex="0"
                                            aria-controls="table2" rowspan="1" colspan="1"
                                            aria-label="Platform(s): activate to sort column ascending"
                                            style="width: 200px;">Status</th>
                                        <th class="text-center" tabindex="0"
                                            aria-controls="table2" rowspan="1" colspan="1"
                                            aria-label="CSS grade: activate to sort column ascending"
                                            style="width: 120px;">Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="account : ${accounts}" class="gradeA odd" role="row">
                                        <td class="text-center" th:text="${account.username}"></td>
                                        <td class="text-center" th:text="${account.roleName}"></td>
                                        <td class="text-center" th:text="${account.active}"></td>
                                        <td class="text-center">
                                            <a th:href="@{/admin/accounts/detail(username=${account.username})}" class="btn btn-secondary">Detail</a>
                                            <a th:href="@{/admin/accounts/update(username=${account.username})}" class="btn btn-info">Update</a>
                                            <a href="#" th:onclick="confirmDelete([[${account.username}]])" class="btn btn-danger">Delete</a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal xác nhận xóa -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteLabel">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this account?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
            </div>
        </div>
    </div>
</div>

</body>

<div th:replace="admin/layout/scrips :: scrips"></div>
<script>
    var usernameToDelete;

    function confirmDelete(username) {
        console.log(username)
        usernameToDelete = username; // Lưu username vào biến toàn cục
        $('#confirmDeleteModal').modal('show'); // Hiển thị modal
        document.getElementById("confirmDeleteButton").onclick = function() {
            window.location.href = '/admin/accounts/delete?username=' + usernameToDelete; // Chuyển hướng đến URL xóa
        }
    }


</script>
</html>